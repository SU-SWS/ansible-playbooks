---
# Ansible role for creating a site on Enterprise.
# https://github.com/SU-SWS/ansible-playbooks
# =================================================
#
# The purpose of this role is to instantiate a STATE, in this case the
# existence of a site in Enterprise.
#
# INPUTS:
#   acquia_api_key
#   acquia_username
#   ace_site_name
#   drush_alias
#   existing_sites
#   group_ids
#   inventory_hostname
#   profile
#   site_environment
#   sites_formatted
#   stack_id
#   wait_time
#
# OUTPUTS:
#   bootstrap_status
#   site_created
#   site_exists
#
# ALTERNATIVE ROLES:
# --
#
# REQUIREMENTS:
# --
#
# KNOWN ISSUES:
# --

- name: Check for if DB exits as they exist across all environments
  shell: "{{ drush_alias }} ac-database-info {{ inventory_hostname }}"
  register: db_exists_check
  ignore_errors: "yes"

- name: Install a minimal profile.
  shell: "{{ drush_alias }} si minimal -y"
  when: db_exists_check.stdout is not search('Resource not found')

- name: Rebuild Registry.
  shell: "{{ drush_alias }} rr -y"
  when: db_exists_check.stdout is not search('Resource not found')
